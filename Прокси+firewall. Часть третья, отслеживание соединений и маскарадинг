
root@ubus004:~# iptables -L
Chain INPUT (policy ACCEPT)
target     prot opt source               destination

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination

root@ubus004:~# iptables-restore < iptables.backup
root@ubus004:~# iptables -L
Chain INPUT (policy DROP)
target     prot opt source               destination
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh
ACCEPT     icmp --  anywhere             anywhere

Chain FORWARD (policy DROP)
target     prot opt source               destination

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination

root@ubus004:~# iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
root@ubus004:~# iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
root@ubus004:~# iptables-save
# Generated by iptables-save v1.6.0 on Mon Dec  4 19:28:12 2017
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [63:6472]
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
COMMIT
# Completed on Mon Dec  4 19:28:12 2017

root@ubus004:~# iptables -t filter -A FORWARD -p icmp -j ACCEPT
root@ubus004:~# iptables -L
Chain INPUT (policy DROP)
target     prot opt source               destination
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh
ACCEPT     icmp --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED

Chain FORWARD (policy DROP)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED
ACCEPT     icmp --  anywhere             anywhere

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination




root@ubus004:~# iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -j MASQUERADE
root@ubus004:~# iptables -t nat -L
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination

Chain INPUT (policy ACCEPT)
target     prot opt source               destination

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination
MASQUERADE  all  --  10.0.0.0/24          anywhere


root@ubus004:~# apt-get install iptables-persistent
root@ubus004:~# cat /etc/iptables/rules.v4
# Generated by iptables-save v1.6.0 on Mon Dec  4 20:22:41 2017
*nat
:PREROUTING ACCEPT [200:25495]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [11:754]
:POSTROUTING ACCEPT [11:754]
-A POSTROUTING -s 10.0.0.0/24 -j MASQUERADE
COMMIT
# Completed on Mon Dec  4 20:22:41 2017
# Generated by iptables-save v1.6.0 on Mon Dec  4 20:22:41 2017
*filter
:INPUT DROP [203:25591]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [533:60185]
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -p icmp -j ACCEPT
COMMIT
# Completed on Mon Dec  4 20:22:41 2017

root@ubus004:~# iptables-save > iptables.backup2




